import{L as P,l as A,O as G,i as I,b as R,u as k,D as g,R as q,c as x}from"./stats.module.6802f85e.js";import{A as H,S as j,P as B,at as U,F as z}from"./vendor.f1de933b.js";import{e as O,g as W}from"./assets.d9fd3e26.js";import{m as $}from"./makeCommonGUI.95201cda.js";const J=[],K=O.Dirlight,N=W.DamagedHelmet;let b=null,r=!1;const a=document.querySelector("#container"),y=document.querySelector(".loadingText"),n=new P({canvasAlpha:!0});n.bounces=2;n.renderWhenOffFocus=!1;n.useTileRender=!1;n.toneMapping=H;n.envMapIntensity=2;n.enableDenoise=!1;n.enableTemporalDenoise=!0;n.enableSpatialDenoise=!0;document.body.appendChild(n.domElement);const h=!0;let E=!1;const{initStats:Q,initGUI:V,initCameraDebugInfo:X}=$();n.loadingCallback={onProgress:e=>{console.log(e)},onComplete:e=>{y.innerText=e,l(!1),E||(Y(),V(h,n),_()),E=!0,console.log(e)}};const u=Q(h),M=X(h);let S=null,f=null;function Y(){n.setDenoiseColorFactor(2),n.setDenoisePositionFactor(.01)}const i=new j;A(J,i);const o=new B(45,window.innerWidth/window.innerHeight,.001,1e3),p=new G(o,n.domElement);p.screenSpacePanning=!0;function v(e){b&&i.remove(b);const t=e.scene;ee(t),i.add(t),b=t,k(o,p,i)}function D(e){i.environment=e}function Z(){const e=document.querySelector("#bubble");document.querySelector("#bubble-close").onclick=()=>{e.style.display="none"},localStorage.getItem("bubble")||(e.style.display="block",document.querySelector(".bubble-confirm").onclick=()=>{e.style.display="none",localStorage.setItem("bubble",!0)})}function T(e){const t=document.querySelector("#bubble");t.style.display="block",document.querySelector(".bubble-text").innerText=e}function L(e){e?a.classList.contains("isDroping")||a.classList.add("isDroping"):a.classList.contains("isDroping")&&a.classList.remove("isDroping")}function l(e){e?a.classList.contains("isLoading")||a.classList.add("isLoading"):a.classList.contains("isLoading")&&a.classList.remove("isLoading")}function _(){const e=n.domElement;e.addEventListener("dragenter",s=>{L(!0)}),e.addEventListener("dragleave",s=>{L(!1)});const t=new U(e,e);t.on("drop",({files:s})=>{if(L(!1),r){T("previous assets no loading complete!");return}r=!0,y.innerText="Building...",l(!0);const c=Array.from(s);c.find(([d,m])=>m.name.match(/\.(gltf|glb)$/))?I(s).then(d=>{v(d),console.log("gltfInfo",d),n.buildScene(i,o).then(()=>{r=!1,l(!1)})}):c.find(([m,F])=>F.name.match(/\.(hdr)$/))?R(s).then(m=>{D(m),n.updateEnvLight(),n.needsUpdate=!0,r=!1,l(!1)}):(r=!1,l(!1),T("Incorrect resource type(support gltf/glb folder or hdr file)!"))}),t.on("droperror",()=>{console.log("Drop Error")}),Z()}function ee(e){e.traverse(t=>{if(t.isMesh&&t.material){if(t.material.isRayTracingMaterial)return;t.material.isMeshStandardMaterial?t.material=new g().fromStandardMaterial(t.material):t.material.isMeshBasicMaterial||t.material.isMeshLambertMaterial||t.material.isMeshToonMaterial?t.material=new g().fromBasicMaterial(t.material):t.material=new g}})}async function te(){const e=new q().setDataType(z),t=await new Promise(c=>{e.load(K,c)});D(t);const s=await x(N);v(s),p.target.y-=.18,n.buildScene(i,o).then(()=>{C()})}function w(){if(n.domElement.parentElement){const e=n.domElement.parentElement.clientWidth,t=n.domElement.parentElement.clientHeight;n.setSize(e,t),o.aspect=e/t,o.updateProjectionMatrix()}}window.addEventListener("resize",w);w();function C(e){p.update(),u&&u.begin(),n.render(i,o),u&&u.end(),M&&(f=n.getTotalSamples(),S!=f&&(M.innerText=`Samples: ${f}`,S=f)),requestAnimationFrame(C)}te();
