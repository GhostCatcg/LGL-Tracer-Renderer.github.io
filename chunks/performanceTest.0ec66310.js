import{L as F,l as G,O as I,i as R,c as k,u as q,D as p,R as x,d as A,e as H,g as j}from"./stats.module.023fcc8e.js";import{S as B,P as U,au as z}from"./vendor.4a9eae3d.js";import{m as O}from"./makeCommonGUI.3b50ebcc.js";const W=[],$=H.Dirlight,J=j.DamagedHelmet;let b=null,r=!1;const a=document.querySelector("#container"),y=document.querySelector(".loadingText"),n=new F;n.bounces=2;n.renderWhenOffFocus=!1;n.useTileRender=!1;n.envMapIntensity=1;n.enableDenoise=!1;n.enableTemporalDenoise=!0;n.enableSpatialDenoise=!0;document.body.appendChild(n.domElement);const h=!0;let E=!1;const{initStats:K,initGUI:N,initCameraDebugInfo:Q}=O();n.loadingCallback={onProgress:e=>{console.log(e)},onComplete:e=>{y.innerText=e,l(!1),E||(V(),N(h,n),Y()),E=!0,console.log(e)}};const m=K(h),S=Q(h);let M=null,u=null;function V(){n.setDenoiseColorFactor(2),n.setDenoisePositionFactor(.01)}const i=new B;G(W,i);const o=new U(35,window.innerWidth/window.innerHeight,.001,1e3),f=new I(o,n.domElement);f.screenSpacePanning=!0;function v(e){b&&i.remove(b);const t=e.scene;Z(t),i.add(t),b=t,q(o,f,i)}function D(e){i.environment=e}function X(){const e=document.querySelector("#bubble");document.querySelector("#bubble-close").onclick=()=>{e.style.display="none"},localStorage.getItem("bubble")||(e.style.display="block",document.querySelector(".bubble-confirm").onclick=()=>{e.style.display="none",localStorage.setItem("bubble",!0)})}function w(e){const t=document.querySelector("#bubble");t.style.display="block",document.querySelector(".bubble-text").innerText=e}function L(e){e?a.classList.contains("isDroping")||a.classList.add("isDroping"):a.classList.contains("isDroping")&&a.classList.remove("isDroping")}function l(e){e?a.classList.contains("isLoading")||a.classList.add("isLoading"):a.classList.contains("isLoading")&&a.classList.remove("isLoading")}function Y(){const e=n.domElement;e.addEventListener("dragenter",s=>{L(!0)}),e.addEventListener("dragleave",s=>{L(!1)});const t=new z(e,e);t.on("drop",({files:s})=>{if(L(!1),r){w("previous assets no loading complete!");return}r=!0,y.innerText="Building...",l(!0);const c=Array.from(s);c.find(([g,d])=>d.name.match(/\.(gltf|glb)$/))?R(s).then(g=>{v(g),n.buildScene(i,o).then(()=>{r=!1,l(!1)})}):c.find(([d,P])=>P.name.match(/\.(hdr)$/))?k(s).then(d=>{D(d),n.updateEnvLight(),n.needsUpdate=!0,r=!1,l(!1)}):(r=!1,l(!1),w("Incorrect resource type(support gltf/glb folder or hdr file)!"))}),t.on("droperror",()=>{console.log("Drop Error")}),X()}function Z(e){e.traverse(t=>{if(t.isMesh&&t.material){if(t.material.isRayTracingMaterial)return;t.material.isMeshStandardMaterial?t.material=new p().fromStandardMaterial(t.material):t.material.isMeshBasicMaterial||t.material.isMeshLambertMaterial||t.material.isMeshToonMaterial?t.material=new p().fromBasicMaterial(t.material):t.material=new p}})}async function _(){const e=new x,t=await new Promise(c=>{e.load($,c)});D(t);const s=await A(J);v(s),f.target.y-=.18,n.buildScene(i,o).then(()=>{C()})}function T(){if(n.domElement.parentElement){const e=n.domElement.parentElement.clientWidth,t=n.domElement.parentElement.clientHeight;n.setSize(e,t),o.aspect=e/t,o.updateProjectionMatrix()}}window.addEventListener("resize",T);T();function C(e){f.update(),m&&m.begin(),n.render(i,o),m&&m.end(),S&&(u=n.getTotalSamples(),M!=u&&(S.innerText=`Samples: ${u}`,M=u)),requestAnimationFrame(C)}_();
