import{L as P,l as G,O as I,i as R,b as k,u as q,D as p,R as x,c as A}from"./stats.module.6802f85e.js";import{S as H,P as j,at as B,F as U}from"./vendor.f1de933b.js";import{e as z,g as O}from"./assets.d9fd3e26.js";import{m as W}from"./makeCommonGUI.95201cda.js";const $=[],J=z.Dirlight,K=O.DamagedHelmet;let b=null,r=!1;const a=document.querySelector("#container"),y=document.querySelector(".loadingText"),n=new P;n.bounces=2;n.renderWhenOffFocus=!1;n.useTileRender=!1;n.envMapIntensity=1;n.enableDenoise=!1;n.enableTemporalDenoise=!0;n.enableSpatialDenoise=!0;document.body.appendChild(n.domElement);const h=!0;let E=!1;const{initStats:N,initGUI:Q,initCameraDebugInfo:V}=W();n.loadingCallback={onProgress:e=>{console.log(e)},onComplete:e=>{y.innerText=e,l(!1),E||(X(),Q(h,n),Z()),E=!0,console.log(e)}};const m=N(h),S=V(h);let D=null,u=null;function X(){n.setDenoiseColorFactor(2),n.setDenoisePositionFactor(.01)}const i=new H;G($,i);const o=new j(35,window.innerWidth/window.innerHeight,.001,1e3),f=new I(o,n.domElement);f.screenSpacePanning=!0;function M(e){b&&i.remove(b);const t=e.scene;_(t),i.add(t),b=t,q(o,f,i)}function v(e){i.environment=e}function Y(){const e=document.querySelector("#bubble");document.querySelector("#bubble-close").onclick=()=>{e.style.display="none"},localStorage.getItem("bubble")||(e.style.display="block",document.querySelector(".bubble-confirm").onclick=()=>{e.style.display="none",localStorage.setItem("bubble",!0)})}function T(e){const t=document.querySelector("#bubble");t.style.display="block",document.querySelector(".bubble-text").innerText=e}function L(e){e?a.classList.contains("isDroping")||a.classList.add("isDroping"):a.classList.contains("isDroping")&&a.classList.remove("isDroping")}function l(e){e?a.classList.contains("isLoading")||a.classList.add("isLoading"):a.classList.contains("isLoading")&&a.classList.remove("isLoading")}function Z(){const e=n.domElement;e.addEventListener("dragenter",s=>{L(!0)}),e.addEventListener("dragleave",s=>{L(!1)});const t=new B(e,e);t.on("drop",({files:s})=>{if(L(!1),r){T("previous assets no loading complete!");return}r=!0,y.innerText="Building...",l(!0);const c=Array.from(s);c.find(([g,d])=>d.name.match(/\.(gltf|glb)$/))?R(s).then(g=>{M(g),n.buildScene(i,o).then(()=>{r=!1,l(!1)})}):c.find(([d,F])=>F.name.match(/\.(hdr)$/))?k(s).then(d=>{v(d),n.updateEnvLight(),n.needsUpdate=!0,r=!1,l(!1)}):(r=!1,l(!1),T("Incorrect resource type(support gltf/glb folder or hdr file)!"))}),t.on("droperror",()=>{console.log("Drop Error")}),Y()}function _(e){e.traverse(t=>{if(t.isMesh&&t.material){if(t.material.isRayTracingMaterial)return;t.material.isMeshStandardMaterial?t.material=new p().fromStandardMaterial(t.material):t.material.isMeshBasicMaterial||t.material.isMeshLambertMaterial||t.material.isMeshToonMaterial?t.material=new p().fromBasicMaterial(t.material):t.material=new p}})}async function ee(){const e=new x().setDataType(U),t=await new Promise(c=>{e.load(J,c)});v(t);const s=await A(K);M(s),f.target.y-=.18,n.buildScene(i,o).then(()=>{C()})}function w(){if(n.domElement.parentElement){const e=n.domElement.parentElement.clientWidth,t=n.domElement.parentElement.clientHeight;n.setSize(e,t),o.aspect=e/t,o.updateProjectionMatrix()}}window.addEventListener("resize",w);w();function C(e){f.update(),m&&m.begin(),n.render(i,o),m&&m.end(),S&&(u=n.getTotalSamples(),D!=u&&(S.innerText=`Samples: ${u}`,D=u)),requestAnimationFrame(C)}ee();
