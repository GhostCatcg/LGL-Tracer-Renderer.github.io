import{L as G,l as I,O as R,i as x,b as A,u as k,D as b,R as q,c as H}from"./stats.module.6802f85e.js";import{A as j,S as B,P as U,at as z,F as O}from"./vendor.f1de933b.js";import{e as W,g as $}from"./assets.d9fd3e26.js";import{m as J}from"./makeCommonGUI.95201cda.js";const K=[],N=W.Dirlight,Q=$.DamagedHelmet;let h=null,m=null,r=!1;const a=document.querySelector("#container"),E=document.querySelector(".loadingText"),n=new G;n.bounces=2;n.renderWhenOffFocus=!0;n.useTileRender=!1;n.toneMapping=j;n.envMapIntensity=2;n.enableTemporalDenoise=!1;document.body.appendChild(n.domElement);const L=!0;let M=!1;const{initStats:V,initGUI:X,initCameraDebugInfo:Y}=J();n.loadingCallback={onProgress:e=>{console.log(e)},onComplete:e=>{E.innerText=e,l(!1),M||(Z(),X(L,n),ee()),M=!0,console.log(e)}};const u=V(L),S=Y(L);let T=null,f=null;function Z(){n.setDenoiseColorFactor(2),n.setDenoisePositionFactor(.01)}const i=new B;I(K,i);const o=new U(45,window.innerWidth/window.innerHeight,.001,1e3),g=new R(o,n.domElement);g.screenSpacePanning=!0;function v(e){h&&i.remove(h);const t=e.scene;te(t),i.add(t),h=t,k(o,g,i)}function w(e){m&&m.isTexture&&m.dispose(),i.environment=e,m=e}function _(){const e=document.querySelector("#bubble");document.querySelector("#bubble-close").onclick=()=>{e.style.display="none"},localStorage.getItem("bubble")||(e.style.display="block",document.querySelector(".bubble-confirm").onclick=()=>{e.style.display="none",localStorage.setItem("bubble",!0)})}function D(e){const t=document.querySelector("#bubble");t.style.display="block",document.querySelector(".bubble-text").innerText=e}function y(e){e?a.classList.contains("isDroping")||a.classList.add("isDroping"):a.classList.contains("isDroping")&&a.classList.remove("isDroping")}function l(e){e?a.classList.contains("isLoading")||a.classList.add("isLoading"):a.classList.contains("isLoading")&&a.classList.remove("isLoading")}function ee(){const e=n.domElement;e.addEventListener("dragenter",s=>{y(!0)}),e.addEventListener("dragleave",s=>{y(!1)});const t=new z(e,e);t.on("drop",({files:s})=>{if(y(!1),r){D("previous assets no loading complete!");return}r=!0,E.innerText="Building...",l(!0);const c=Array.from(s);c.find(([p,d])=>d.name.match(/\.(gltf|glb)$/))?x(s).then(p=>{v(p),n.buildScene(i,o).then(()=>{r=!1,l(!1)})}):c.find(([d,P])=>P.name.match(/\.(hdr)$/))?A(s).then(d=>{w(d),n.updateEnvLight(),n.needsUpdate=!0,r=!1,l(!1)}):(r=!1,l(!1),D("Incorrect resource type(support gltf/glb folder or hdr file)!"))}),t.on("droperror",()=>{console.log("Drop Error")}),_()}function te(e){e.traverse(t=>{if(t.isMesh&&t.material){if(t.material.isRayTracingMaterial)return;t.material.isMeshStandardMaterial?t.material=new b().fromStandardMaterial(t.material):t.material.isMeshBasicMaterial||t.material.isMeshLambertMaterial||t.material.isMeshToonMaterial?t.material=new b().fromBasicMaterial(t.material):t.material=new b}})}async function ne(){const e=new q().setDataType(O),t=await new Promise(c=>{e.load(N,c)});w(t);const s=await H(Q);v(s),g.target.y-=.18,n.buildScene(i,o).then(()=>{F()})}function C(){if(n.domElement.parentElement){const e=n.domElement.parentElement.clientWidth,t=n.domElement.parentElement.clientHeight;n.setSize(e,t),o.aspect=e/t,o.updateProjectionMatrix()}}window.addEventListener("resize",C);C();function F(e){g.update(),u&&u.begin(),n.render(i,o),u&&u.end(),S&&(f=n.getTotalSamples(),T!=f&&(S.innerText=`Samples: ${f}`,T=f)),requestAnimationFrame(F)}ne();
