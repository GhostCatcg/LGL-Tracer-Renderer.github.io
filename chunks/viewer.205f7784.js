import{L as G,l as I,O as R,i as x,c as A,u as k,D as b,R as q,d as H,e as j,g as B}from"./stats.module.9a08a616.js";import{A as U,S as z,P as O,au as W}from"./vendor.4a9eae3d.js";import{m as $}from"./makeCommonGUI.8426dbd5.js";const J=[],K=j.Dirlight,N=B.DamagedHelmet;let h=null,m=null,r=!1;const a=document.querySelector("#container"),y=document.querySelector(".loadingText"),n=new G;n.bounces=2;n.renderWhenOffFocus=!0;n.useTileRender=!1;n.toneMapping=U;n.envMapIntensity=2;n.enableTemporalDenoise=!1;document.body.appendChild(n.domElement);const L=!0;let M=!1;const{initStats:Q,initGUI:V,initCameraDebugInfo:X}=$();n.loadingCallback={onProgress:e=>{console.log(e)},onComplete:e=>{y.innerText=e,l(!1),M||(Y(),V(L,n),_()),M=!0,console.log(e)}};const u=Q(L),S=X(L);let v=null,f=null;function Y(){n.setDenoiseColorFactor(2),n.setDenoisePositionFactor(.01)}const i=new z;I(J,i);const o=new O(45,window.innerWidth/window.innerHeight,.001,1e3),g=new R(o,n.domElement);g.screenSpacePanning=!0;function T(e){h&&i.remove(h);const t=e.scene;ee(t),i.add(t),h=t,k(o,g,i)}function w(e){m&&m.isTexture&&m.dispose(),i.environment=e,m=e}function Z(){const e=document.querySelector("#bubble");document.querySelector("#bubble-close").onclick=()=>{e.style.display="none"},localStorage.getItem("bubble")||(e.style.display="block",document.querySelector(".bubble-confirm").onclick=()=>{e.style.display="none",localStorage.setItem("bubble",!0)})}function D(e){const t=document.querySelector("#bubble");t.style.display="block",document.querySelector(".bubble-text").innerText=e}function E(e){e?a.classList.contains("isDroping")||a.classList.add("isDroping"):a.classList.contains("isDroping")&&a.classList.remove("isDroping")}function l(e){e?a.classList.contains("isLoading")||a.classList.add("isLoading"):a.classList.contains("isLoading")&&a.classList.remove("isLoading")}function _(){const e=n.domElement;e.addEventListener("dragenter",s=>{E(!0)}),e.addEventListener("dragleave",s=>{E(!1)});const t=new W(e,e);t.on("drop",({files:s})=>{if(E(!1),r){D("previous assets no loading complete!");return}r=!0,y.innerText="Building...",l(!0);const c=Array.from(s);c.find(([p,d])=>d.name.match(/\.(gltf|glb)$/))?x(s).then(p=>{T(p),n.buildScene(i,o).then(()=>{r=!1,l(!1)})}):c.find(([d,P])=>P.name.match(/\.(hdr)$/))?A(s).then(d=>{w(d),n.updateEnvLight(),n.needsUpdate=!0,r=!1,l(!1)}):(r=!1,l(!1),D("Incorrect resource type(support gltf/glb folder or hdr file)!"))}),t.on("droperror",()=>{console.log("Drop Error")}),Z()}function ee(e){e.traverse(t=>{if(t.isMesh&&t.material){if(t.material.isRayTracingMaterial)return;t.material.isMeshStandardMaterial?t.material=new b().fromStandardMaterial(t.material):t.material.isMeshBasicMaterial||t.material.isMeshLambertMaterial||t.material.isMeshToonMaterial?t.material=new b().fromBasicMaterial(t.material):t.material=new b}})}async function te(){const e=new q,t=await new Promise(c=>{e.load(K,c)});w(t);const s=await H(N);T(s),g.target.y-=.18,n.buildScene(i,o).then(()=>{F()})}function C(){if(n.domElement.parentElement){const e=n.domElement.parentElement.clientWidth,t=n.domElement.parentElement.clientHeight;n.setSize(e,t),o.aspect=e/t,o.updateProjectionMatrix()}}window.addEventListener("resize",C);C();function F(e){g.update(),u&&u.begin(),n.render(i,o),u&&u.end(),S&&(f=n.getTotalSamples(),v!=f&&(S.innerText=`Samples: ${f}`,v=f)),requestAnimationFrame(F)}te();
